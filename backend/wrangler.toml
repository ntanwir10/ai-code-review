# Cloudflare Workers Configuration for GuardScan Backend
# Documentation: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "guardscan-backend"
main = "src/index.ts"
compatibility_date = "2024-11-13"
workers_dev = true

# Account details (set via wrangler CLI or environment variables)
# Get your account_id from: https://dash.cloudflare.com/
# account_id = "your-account-id"

[build]
command = "npm install && npx tsc"

[build.upload]
format = "service-worker"

# Environment variables (non-sensitive)
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"
MAX_REQUEST_SIZE_MB = 10

# Secrets (NEVER commit these - set via: wrangler secret put SECRET_NAME)
# Required secrets for production:
# - SUPABASE_URL          (from Supabase dashboard → Settings → API)
# - SUPABASE_KEY          (service_role key from Supabase)
# - STRIPE_SECRET_KEY     (from Stripe dashboard → Developers → API keys)
# - STRIPE_WEBHOOK_SECRET (from Stripe dashboard → Webhooks)
#
# Setup commands:
#   wrangler secret put SUPABASE_URL
#   wrangler secret put SUPABASE_KEY
#   wrangler secret put STRIPE_SECRET_KEY
#   wrangler secret put STRIPE_WEBHOOK_SECRET

# KV Namespace for caching
# [[kv_namespaces]]
# binding = "CACHE"
# id = "your-kv-namespace-id"
# preview_id = "your-preview-kv-namespace-id"

# Staging environment
[env.staging]
name = "guardscan-backend-staging"
# Uncomment and configure when you have a custom domain:
# route = { pattern = "api-staging.guardscan.com/*", zone_name = "guardscan.com" }
vars = { ENVIRONMENT = "staging", API_VERSION = "v1" }

# Production environment
[env.production]
name = "guardscan-backend-production"
# Uncomment and configure when you have a custom domain:
# route = { pattern = "api.guardscan.com/*", zone_name = "guardscan.com" }
vars = { ENVIRONMENT = "production", API_VERSION = "v1", MAX_REQUEST_SIZE_MB = 10 }

# Routes (if using custom domains)
# routes = [
#   { pattern = "api.guardscancli.com/*", zone_name = "guardscancli.com" }
# ]

# Limits and configuration
[limits]
cpu_ms = 50

# Triggers (for scheduled tasks if needed)
# [triggers]
# crons = ["0 0 * * *"]  # Daily at midnight
